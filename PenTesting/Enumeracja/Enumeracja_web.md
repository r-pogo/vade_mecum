## Gobuster
It enumerates web directories, DNS subdomains, vhosts, Amazon S3 buckets, and Google Cloud Storage by brute force, 
using specific wordlists and handling the incoming responses.

`https://github.com/OJ/gobuster`
`sudo apt install gobuster`

````
Reconnaissance ---> Active Scanning ---> Scanning IP Blocks  
                                   |
                                   |---> Wordlist Scanning  
````
## Fuzz Faster U Fool (ffuf) 
Narzędzie do fuzzowania i odkrywania katalogów na stronach internetowych.  
[github](https://github.com/ffuf/ffuf)

## Słowniki 
Kali Linux default lists:
This is as of the latest version at the time of writing which is 2020.3. 
Anything with a wildcard (*) character indicates there's more than one list that matches. 
Keep in mind, a lot of these can be interchanged between modes. 
For example, "dir" mode wordlists (such as ones from the dirbuster directory) will contain words like 
"admin", "index", "about", "events", etc. A lot of these could be subdomains as well.
```
/usr/share/wordlists/dirbuster/directory-list-2.3-*.txt
/usr/share/wordlists/dirbuster/directory-list-1.0.txt
/usr/share/wordlists/dirb/big.txt
/usr/share/wordlists/dirb/common.txt
/usr/share/wordlists/dirb/small.txt
/usr/share/wordlists/dirb/extensions_common.txt - Useful for when fuzzing for files!
```
Non standard lists  
[SecLists](https://github.com/danielmiessler/SecLists)  
`git clone https://github.com/danielmiessler/SecLists.git`  
albo  
` sudo apt install seclists`  
___
### Enumeracja katalogów i plików
`gobuster dir --help`

Gobuster has a dir mode, allowing users to enumerate website directories and their files. 
This mode is useful when you are performing a penetration test and would like to see what the directory structure 
of a website is and what files it contains.

`gobuster dir -u "http://www.example.thm" -w /path/to/wordlist`

`gobuster dir -u "http://www.example.thm" -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -r`

This command scans all the directories located at www.example.thm using the wordlist directory-list-2.3-medium.txt. 
Let’s look a bit closer at each part of the command:

`gobuster dir`: Configures Gobuster to use the directory and file enumeration mode.
`-u http://www.example.thm`: The URL will be the base path where Gobuster starts looking.  
So, the URL  above is using the root web directory. For example, in a typical Apache installation on Linux,  
this is /var/www/html. So if you have a “resources” directory and you want to enumerate that directory,  
you’d set the URL as http://www.example.thm/resources. You can also think of this like `http://www.example.thm/path/to/folder`.
The URL must contain the protocol used, in this case, HTTP. This is important and required.  
If you pass the wrong protocol, the scan will fail.
In the host part of the URL, you can either fill in the IP or the HOSTNAME.  
However, it is important to mention that when using the IP, you may target a different website than intended.  
A web server can host multiple websites using one IP (this technique is also called virtual hosting).  
Use the HOSTNAME if you want to be sure.
Gobuster does not enumerate recursively. So, if the results show a directory path you are interested in, you will have  
to enumerate that specific directory.
`-w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt`: configures Gobuster to use the directory-list-2.3-medium.txt wordlist to enumerate.  
Each entry of the wordlist is appended to the configured URL.
`-r`: configures Gobuster to follow the redirect responses received from the sent requests.  
If a status code 301 was received, Gobuster will navigate to the redirect URL that is included in the response.  

`gobuster dir -u "http://www.example.thm" -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php,.js`  

This command will look for directories located at http://example.thm using the wordlist directory-list-2.3-medium.txt.  
In addition to directory listing, this command also lists all the files that have a .php or .js extension.

Przyklady ze studiów:
`gobuster dir -u http://192.168.100.4/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-directories.txt`  
lub  
`ffuf-w /usr/share/seclists/Discovery/Web-Content/raft-small-directories.txt-u http://192.168.100.4/FUZZ/`  
`ffuf-w /usr/share/seclists/Discovery/Web-Content/raft-small-directories.txt-u http://192.168.100.4/FUZZ/ -fs <rozmiar>`  

fs <rozmiar> - filtr dla ffuf, aby nie wyświetlał odpowiedzi HTTP o konkretnym rozmiarze

Wynikiem enumeracji katalogów było `_private`

Wyszukiwany jes ukryty plik php w katalogu _private:

`gobuster dir -u http://192.168.100.4/_private/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-files.txt`  
lub  
`ffuf-w /usr/share/seclists/Discovery/Web-Content/raft-small-files.txt-u http://192.168.100.4/_private/FUZZ`  
`ffuf-w /usr/share/seclists/Discovery/Web-Content/raft-small-files.txt-u http://192.168.100.4/_private/FUZZ -fs <rozmiar>`  

### Enumerating DNS subdomains
[Certificate search](https://crt.sh)
Certificate Transparency (CT) logs are public records of SSL/TLS certificates issued for domains by Certificate Authorities (CAs). Their purpose is to prevent misuse or unauthorized certificates.  
The purpose of Certificate Transparency logs is to stop malicious and accidentally made certificates from being used. We can use this service to our advantage to discover subdomains belonging to a domain, sites like https://crt.sh offer a searchable database of certificates that shows current and historical results.  

**OSINT Search Engines**, example Google:  
`site:*.domain.com -site:www.domain.com` would only contain results leading to the domain name domain.com but exclude any links to www.domain.com; therefore, it shows us only subdomain names belonging to domain.com

**DNS Bruteforece** with `dnsrecon`

**Automate the OSINT subdomain discovery** with tool `Sublist3r`

`gobuster dns -h` for help  menu

`gobuster dns -d example.thm -w /path/to/wordlist`

`gobuster dns -d example.thm -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt`

`gobuster dns`: enumerates subdomains on the configured domain.
`-d example.thm`: sets the target to the example.thm domain.
`-w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt` sets the wordlist to subdomains-top1million-5000.txt.  
Gobuster uses each entry of this list to construct a new DNS query.  
If the first entry of this list is 'all', the query would be all.example.thm.

`gobuster dns -d coffeShop.com --show-ip --worldlist /home/student/Desktop/tools/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -o output.txt`

`-d`: to define the top domain for the enumeration  
`--show-ips`: to see IP addresses of the subdomains enumerated  
`--wordlist`: specify the wrodlist to be used  
`-o`: to define the output file where to save the results  

### Enumeracja Vhostów
`gobuster vhost -h`  
Vhost mode, this mode allows Gobuster to brute force virtual hosts.  
Virtual hosts are different websites on the same machine. Sometimes, they look like subdomains,  
but don’t be deceived! Virtual hosts are IP-based and are running on the same server.  
Subdomains are set up in DNS. The  difference between vhost and dns mode is in the way Gobuster scans:

`vhost mode` will navigate to the URL created by combining the configured HOSTNAME (-u flag) with an entry of a wordlist.  
`dns mode` will do a DNS lookup to the FQDN created by combining the configured domain name (-d flag) with an entry of a wordlist

`gobuster vhost -u "http://example.thm" -w /path/to/wordlist`
practical example:
`gobuster vhost -u "http://10.10.103.198" --domain example.thm -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt --append-domain --exclude-length 250-320`

You will notice that this command is much more complex than the base command syntax. It contains many more configured flags.  
In our case, we don't have a fully set up DNS infrastructure. This requires us to give in extra flags like `--domain` and `--append-domain`.  
We need to look at the web requests Gobuster sends to understand better how these flags work. Below, you can see a basic GET request to www.example.thm

```
GET / HTTP/1.1
Host: www.example.thm
User-Agent: gobuster/3.6
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive

```

Gobuster will send multiple requests, each time changing the Host: part of the request.  
The value of Host: in this example is www.example.thm. We can break this down into three parts:

`www`: This is the subdomain. This is the part that Gobuster will fill in with each entry of the configured wordlist.
`.example`: This is the second-level domain. You can configure this with the `--domain flag` (this needs to be configured together with the top-level domain).
`.thm`: This is the top-level domain. You can configure this with the `--domain flag` (this needs to be configured together with the second-level domain).
Now that we know how Gobuster sends its request, let's break down the command and examine each flag more closely:

`gobuster vhost`: instructs Gobuster to enumerate virtual hosts.
`-u "http://10.10.103.198"`: sets the URL to browse to 10.10.103.198.
`-w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt`: configures Gobuster to use the subdomains-top1million-5000.txt wordlist.  
Gobuster appends each entry in the wordlist to the configured domain.  
If no domain is explicitly configured with the `--domain flag`, Gobuster will extract it from the URL. E.g., test.example.thm, help.example.thm, etc.  
If any subdomains are found, Gobuster will report them to you in the terminal.
`--domain example.thm`: sets the top- and second-level domains in the Hostname: part of the request to example.thm.
`--append-domain`: appends the configured domain to each entry in the wordlist. If this flag is not configured, the set hostname would be www, blog, etc.  
This will cause the command to work incorrectly and display false positives.
`--exclude-length`: filters the responses we get from the sent web requests.  
With this flag, we can filter out the false positives. If you run the command without this flag,  
you will notice you will get a lot of false positives like "Found: Orion.example.thm Status: 404 [Size: 279]" or   
"Found: pm.example.thm Status: 404 [Size: 276]".  
These false positives typically have a similar response size, so we can use this to filter out most  
false positives. We expect to get a 200 OK response back to have a true positive.  

Inny przykład:  
`gobuster vhost -u http://blog.coffeShop.com -w /home/student/Desktop/tools/SecLists/Discovery/DNS/subdomains-top1million-5000.txt --domain coffeShop. -o output.txt`

`-u`: to define server that I'm testing
`-w`: to defin the word list
`--domain`: to define the domain that will be appended to the world list. Every word i the wordlist  
will be appended with the .coffeeShop.com
`-o`: output file

Look for the 200 status result in the output.
Change the host header in burp suit with the subdomain:
instead of blog.coffeShop.com for example admin.coffeShop.com
If you want  to use browser you can use the ip address of cofeeShop with the subdomain: example: 192.168.1.50 admin.coffeShop.com 
edit like that the `/etc/host` file

Przykłady ze studiów:
Inny przykład: Znalezienie ukrytego wirtualnego hosta skonfigurowanego na `http://192.168.100.4`

`gobuster vhost-u http://192.168.100.4/ -w /usr/share/seclists/Discovery/DNS/fierce-hostlist.txt`  
lub  
`ffuf-w /usr/share/seclists/Discovery/DNS/fierce-hostlist.txt-u http://192.168.100.4/ -H 'Host: FUZZ'`  
`ffuf-w /usr/share/seclists/Discovery/DNS/fierce-hostlist.txt-u http://192.168.100.4/ -H 'Host: FUZZ' -fs <rozmiar>`

Wynik to `business`

Znalezienie subdomeny domeny business:  
`gobuster vhost-u http://192.168.100.4/ -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt --domain business --append-domain`  
lub  
`ffuf-w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http://192.168.100.4/ -H 'Host: FUZZ.business'`  
`ffuf-w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http://192.168.100.4/ -H 'Host: FUZZ.business' -fs <rozmiar>`

### Enumeracja parametrów HTTP
Znalezienie prawidłowego hasła dla parametru password:
`http://192.168.100.4/4.5.php?password=guess`  

`gobuster fuzz -u http://192.168.100.4/4.5.php?password=FUZZ -w /usr/share/seclists/Passwords/darkweb2017-top100.txt`
lub
`ffuf-w /usr/share/seclists/Passwords/darkweb2017-top100.txt -u 'http://192.168.100.4/4.5.php?password=FUZZ'`
`ffuf-w /usr/share/seclists/Passwords/darkweb2017-top100.txt -u 'http://192.168.100.4/4.5.php?password=FUZZ' -fs <rozmiar>`

### Enumeracja username
Najpierw zrób testy manualne aby sprawdzić error message np. **"username already exists"**  
`ffuf -w /usr/share/wordlists/SecLists/Usernames/Names/names.txt -X POST -d "username=FUZZ&email=x&password=x&cpassword=x" -H "Content-Type: application/x-www-form-urlencoded" -u http://MACHINE_IP/customers/signup -mr "username already exists"`  

-`w` → Uses a wordlist of usernames.  
-`X POST` → Sends data via POST method.  
-`d` → Sends form data with FUZZ as a placeholder for usernames.  
-`H` → For adding additional headersSets Content-Type to application/x-www-form-urlencoded.  
-`u` → Specifies the target URL.  
-`mr` → Filters responses containing "username already exists", indicating a valid username.  

Zapisz sprawdzone username w pliku txt, teraz można spróbować przeprowadzić brute force attack:  
` ffuf -w twojPlik_valid_usernames.txt:W1,/usr/share/wordlists/SecLists/Passwords/Common-Credentials/10-million-password-list-top-100.txt:W2 -X POST -d "username=W1&password=W2" -H "Content-Type: application/x-www-form-urlencoded" -u http://MACHINE_IP/customers/login -fc 200` 

- `w valid_usernames.txt:W1,...password-list-top-100.txt:W2` → Uses two wordlists:  
- `W1` for usernames  
- `W2` for passwords  
-`X POST` → Sends requests using the POST method.  
-`d "username=W1&password=W2"` → Inserts usernames and passwords into the request.  
-`H "Content-Type: application/x-www-form-urlencoded"` → Specifies form data format.  
-`u` → Targets the login page URL.  
-`fc 200` → Filters out responses with a 200 status code (failed login), only showing successful attempts.  

## Enumeracja Web-Content 
**ffuf**
`ffuf -w /usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt -u http://MACHINE_IP/FUZZ`  
**gobuster**
`gobuster dir --url http://MACHINE_IP/ -w /usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt`

## Ćwiczenia Pentest

1. Nazwa webpjatk nie jest rozwiązywalna przez DNS, dlatego, aby połączyć się z tym
wirtualnym hostem możemy dodać odpowiedni wpis do pliku /etc/hosts:
`echo '192.168.100.54 webpjatk' | sudo tee-a /etc/hosts`

2.Celem zadania jest enumeracja subdomen domeny webpjatk na serwerze 
192.168.100.54.
Zadanie zostanie automatycznie rozwiązane po ręcznym odwiedzeniu znalezionej 
subdomeny.

`gobuster vhost -u https://192.168.100.54/ -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt --domain webpjatk--append-domain –k`

Przełącznik `–k` pozwala na nawiązanie połączenia SSL, nawet, gdy certyfikat jest niezaufany.
2a. Nazwa admin.webpjatk nie jest rozwiązywalna przez DNS, dlatego aby połączyć
się z tym wirtualnym hostem możemy dodać odpowiedniwpisdo pliku /etc/hosts:
`echo '192.168.100.54 admin.webpjatk' | sudo tee-a /etc/hosts`

3. Celem zadania jest enumeracja katalogów domeny admin.webpjatk na serwerze 
192.168.100.54.
Zadanie zostanie automatycznie rozwiązane po ręcznym odwiedzeniu odkrytego 
katalogu.  
`gobuster dir-u https://admin.webpjatk/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-directories.txt -k`

4. Celem zadania jest enumeracja plików w katalogu https://admin.webpjatk/panel/ 
na serwerze 192.168.100.54
`gobuster dir-u https://admin.webpjatk/panel/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-files.txt -k`

5. Do celu rozwiązania zadania potrzebny nam będzie program o nazwie Hydra.
Hydra to narzędzie używane do przeprowadzania ataków siłowych na systemy
zabezpieczeń, takie jak hasła czy loginy. Jego głównym celem jest automatyczne
testowanie różnych kombinacji haseł i nazw użytkowników na różnych
protokołach i usługach sieciowych. Hydra obsługuje wiele protokołów, w tym
HTTP, FTP, SSH, i inne, co czyni go wszechstronnym narzędziem w testach penetracyjnych. 

Celem zadania jest złamanie hasła metodą słownikową w panelu
https://admin.webpjatk/panel/login.php .
Zadanie zostanie automatycznie rozwiązane po zalogowaniu się poprawnym hasłem.

`hydra -l anything -P /usr/share/seclists/Passwords/darkweb2017-top100.txt 'https-post-form://admin.webpjatk/panel/login.php:p=^PASS^:Wrong password’`

-l nazwa_użytkownika– w naszym przypadku bezznaczenia  
-P słownik haseł
https-post-form– moduł hydry służący do ataku na formularze POST po HTTPS
admin.webpjatk/panel/login.php– URL
p=^PASS^-danedowysłania POST, gdzie ^PASS^ to placeholder na hasła ze słownika
Wrong password–ciąg znakówwyświetlany po podaniu nieprawidłowego hasła

___
## Sources
- tryhackme, Subdomain Enumeration, https://tryhackme.com/room/subdomainenumeration.
- R. Reimao, Reconnaissance with Gobuster, https://app.pluralsight.com/